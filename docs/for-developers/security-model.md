# Модель безопасности

Безопасность — ключевой аспект DeBot, особенно при использовании сторонних модулей. Модель безопасности построена на двух основных принципах: шифровании и изоляции.

## Шифрование данных

Все чувствительные данные в базе данных PostgreSQL зашифрованы с использованием симметричного шифрования Fernet (из библиотеки `cryptography`).

-   **Что шифруется:** `api_id`, `api_hash`, `auth_key` (ключ сессии), пароли от прокси.
-   **Ключ шифрования:** Для шифрования используется уникальный 32-байтный ключ, который вы генерируете при первой настройке. Этот ключ хранится в переменной `USERBOT_ENCRYPTION_KEY` в вашем `.env` файле и **никогда** не должен попадать в репозиторий или публичный доступ. Без этого ключа данные в базе бесполезны.

## Изоляция модулей: `ModuleClient`

По умолчанию DeBot не доверяет никаким модулям. Чтобы предотвратить кражу сессии или другие вредоносные действия, каждый обычный модуль выполняется в "песочнице".

Когда вы вызываете `register(client)` для недоверенного модуля, в `client` передается не настоящий `TelethonClient`, а специальный прокси-объект — **`ModuleClient`**.

### Что блокирует `ModuleClient`?

`ModuleClient` перехватывает обращения к атрибутам и методам реального клиента. Попытка доступа к следующим элементам приведет к немедленному вызову исключения `PermissionError`:

-   `session`: Прямой доступ к объекту сессии и файлу `.session`. **Это главная защита от кражи сессии.**
-   `log_out`: Выход из аккаунта.
-   `connect` / `disconnect` / `is_connected`: Управление состоянием соединения.
-   `__call__`: Низкоуровневый доступ к API-запросам.

При этом все безопасные методы (`send_message`, `edit_message`, `get_entity` и т.д.) работают как обычно, так как `ModuleClient` прозрачно перенаправляет эти вызовы на реальный объект клиента.

## Система доверия

Если вашему модулю для работы необходим доступ к заблокированным методам (например, модуль для управления сессиями), вы должны пометить его как "доверенный".

1.  **В коде модуля:** Установите флаг `__trusted__ = True`.
2.  **В Telegram:** Владелец аккаунта должен выполнить команду `.trustmod <имя_вашего_модуля>`.

Только после выполнения этих двух условий DeBot передаст в функцию `register` вашего модуля **реальный экземпляр `TelegramClient`** без каких-либо ограничений.
